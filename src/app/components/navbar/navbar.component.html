<nav class="navbar" [class.nav-hidden]="hidden" [class.nav-scrolled]="scrolled">
  <div class="navbar-container">
    <!-- Brand Logo -->
    <div class="navbar-brand">
      <a routerLink="/" class="brand-link">
        <span class="brand-icon">TR</span>
        <span class="brand-text">Travner</span>
      </a>
    </div>

    <!-- Main Navigation -->
    <div class="navbar-nav">
      <!-- Regular User Navigation -->
      <div class="nav-links" *ngIf="!isAdmin()">
        <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Home</a>
        <a routerLink="/community" routerLinkActive="active">Community</a>
        <a routerLink="/marketplace" routerLinkActive="active">Marketplace</a>
        <a routerLink="/itineraries" routerLinkActive="active">Itineraries</a>
        <a routerLink="/travel-buddies" routerLinkActive="active">Travel Buddies</a>
      </div>

      <!-- Admin Navigation -->
      <div class="nav-links admin-nav" *ngIf="isAdmin()">
        <a routerLink="/admin" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Dashboard</a>
        <a routerLink="/admin/users" routerLinkActive="active">Users</a>
        <a routerLink="/admin/posts" routerLinkActive="active">Content</a>
        <a routerLink="/admin/orders" routerLinkActive="active">Orders</a>
      </div>
    </div>

    <!-- Right Side Actions -->
    <div class="navbar-actions">
      <!-- Not Authenticated -->
      <div class="auth-buttons" *ngIf="!isAuthenticated">
        <button class="btn btn-outline" (click)="go('/signin')">Sign In</button>
        <button class="btn btn-primary" (click)="go('/signup')">Sign Up</button>
      </div>

      <!-- Authenticated User -->
      <div class="user-section" *ngIf="isAuthenticated">
        <!-- Quick Actions -->
        <div class="quick-actions">
          <!-- AI Chat -->
          <button 
            class="action-btn" 
            (click)="go('/ai-chat')" 
            title="AI Travel Assistant"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12l2 2 4-4"/>
              <path d="M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
          </button>

          <!-- Chat -->
          <button 
            class="action-btn" 
            (click)="go('/chat')" 
            *ngIf="!isAdmin()"
            title="Chat"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
            </svg>
          </button>

          <!-- Cart -->
          <button 
            class="action-btn cart-btn" 
            (click)="go('/marketplace/cart')" 
            *ngIf="!isAdmin() && isMarketplacePage()"
            title="Shopping Cart"
            [class.has-items]="cartItemCount > 0"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="9" cy="21" r="1" />
              <circle cx="20" cy="21" r="1" />
              <path d="m1 1 4 4 13 0 1 8-12 0z" />
            </svg>
            <span class="cart-badge" *ngIf="cartItemCount > 0">{{ cartItemCount }}</span>
          </button>

          <!-- Dashboard -->
          <button 
            class="action-btn" 
            (click)="go('/dashboard')" 
            *ngIf="!isAdmin()"
            title="Dashboard"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7" />
              <rect x="14" y="3" width="7" height="7" />
              <rect x="14" y="14" width="7" height="7" />
              <rect x="3" y="14" width="7" height="7" />
            </svg>
          </button>
        </div>

        <!-- User Profile -->
        <div class="user-profile" [class.active]="showUserMenu">
          <button class="user-btn" (click)="toggleUserMenu()">
            <img 
              [src]="currentUser?.profileImageUrl || 'https://ui-avatars.com/api/?name=' + (currentUser?.firstName || '') + '+' + (currentUser?.lastName || '') + '&background=e74c3c&color=fff&size=32'" 
              [alt]="currentUser?.firstName || currentUser?.userName"
              class="user-avatar"
            >
            <span class="user-name">{{ currentUser?.firstName || currentUser?.userName }}</span>
            <svg class="dropdown-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9" />
            </svg>
          </button>

          <!-- User Menu Dropdown -->
          <div class="user-menu" *ngIf="showUserMenu" (click)="$event.stopPropagation()">
            <!-- User Info -->
            <div class="user-menu-header">
              <div class="user-info">
                <img 
                  [src]="currentUser?.profileImageUrl || 'https://ui-avatars.com/api/?name=' + (currentUser?.firstName || '') + '+' + (currentUser?.lastName || '') + '&background=e74c3c&color=fff&size=40'" 
                  [alt]="currentUser?.firstName || currentUser?.userName"
                  class="user-avatar-large"
                >
                <div class="user-details">
                  <div class="user-name-large">{{ currentUser?.firstName || currentUser?.userName }}</div>
                  <div class="user-role" *ngIf="isAdmin()">Administrator</div>
                  <div class="user-email">{{ currentUser?.email }}</div>
                </div>
              </div>
            </div>

            <!-- Admin Menu Items -->
            <div class="menu-section" *ngIf="isAdmin()">
              <a routerLink="/admin" (click)="closeUserMenu()" class="menu-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="7" height="7" />
                  <rect x="14" y="3" width="7" height="7" />
                  <rect x="14" y="14" width="7" height="7" />
                  <rect x="3" y="14" width="7" height="7" />
                </svg>
                Dashboard
              </a>
              <a routerLink="/admin/users" (click)="closeUserMenu()" class="menu-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                  <circle cx="12" cy="7" r="4" />
                </svg>
                User Management
              </a>
              <a routerLink="/admin/posts" (click)="closeUserMenu()" class="menu-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                </svg>
                Content Moderation
              </a>
              <a routerLink="/admin/orders" (click)="closeUserMenu()" class="menu-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="9" cy="21" r="1" />
                  <circle cx="20" cy="21" r="1" />
                  <path d="m1 1 4 4 13 0 1 8-12 0z" />
                </svg>
                Order Management
              </a>
            </div>

            <!-- Regular User Menu Items -->
            <div class="menu-section" *ngIf="!isAdmin()">
              <a routerLink="/dashboard" (click)="closeUserMenu()" class="menu-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="7" height="7" />
                  <rect x="14" y="3" width="7" height="7" />
                  <rect x="14" y="14" width="7" height="7" />
                  <rect x="3" y="14" width="7" height="7" />
                </svg>
                Dashboard
              </a>
              <a routerLink="/community" (click)="closeUserMenu()" class="menu-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                </svg>
                Community
              </a>
              <a routerLink="/marketplace" (click)="closeUserMenu()" class="menu-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
                </svg>
                Marketplace
              </a>
              <a routerLink="/itineraries" (click)="closeUserMenu()" class="menu-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                </svg>
                Itineraries
              </a>
              <a routerLink="/travel-buddies" (click)="closeUserMenu()" class="menu-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                  <circle cx="12" cy="7" r="4" />
                </svg>
                Travel Buddies
              </a>
              <a routerLink="/local-guides" (click)="closeUserMenu()" class="menu-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="10" r="3" />
                  <path d="M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 7 8 11.7z" />
                </svg>
                Local Guides
              </a>
              <a routerLink="/ai-chat" (click)="closeUserMenu()" class="menu-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 12l2 2 4-4"/>
                  <path d="M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                </svg>
                AI Travel Assistant
              </a>
              <a routerLink="/chat" (click)="closeUserMenu()" class="menu-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                </svg>
                Chat
              </a>
            </div>

            <div class="menu-divider"></div>

            <div class="menu-section">
              <a routerLink="/profile" (click)="closeUserMenu()" class="menu-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                  <circle cx="12" cy="7" r="4" />
                </svg>
                Profile Settings
              </a>
              <button (click)="logout(); closeUserMenu()" class="menu-item logout">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                  <polyline points="16 17 21 12 16 7" />
                  <line x1="21" y1="12" x2="9" y2="12" />
                </svg>
                Sign Out
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Mobile Menu Toggle -->
      <button 
        class="mobile-toggle" 
        (click)="toggleMobileMenu()" 
        aria-label="Toggle menu"
      >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="6" x2="21" y2="6" />
          <line x1="3" y1="12" x2="21" y2="12" />
          <line x1="3" y1="18" x2="21" y2="18" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu Overlay -->
  <div class="mobile-overlay" [class.active]="showMobileMenu" (click)="closeMobileMenu()"></div>

  <!-- Mobile Menu -->
  <div class="mobile-menu" [class.active]="showMobileMenu">
    <div class="mobile-header">
      <div class="mobile-brand">
        <span class="brand-icon">TR</span>
        <span class="brand-text">Travner</span>
      </div>
      <button class="mobile-close" (click)="closeMobileMenu()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </button>
    </div>

    <div class="mobile-content">
      <!-- User Info -->
      <div class="mobile-user-info" *ngIf="isAuthenticated">
        <img 
          [src]="currentUser?.profileImageUrl || 'https://ui-avatars.com/api/?name=' + (currentUser?.firstName || '') + '+' + (currentUser?.lastName || '') + '&background=e74c3c&color=fff&size=48'" 
          [alt]="currentUser?.firstName || currentUser?.userName"
          class="mobile-avatar"
        >
        <div class="mobile-user-details">
          <div class="mobile-user-name">{{ currentUser?.firstName || currentUser?.userName }}</div>
          <div class="mobile-user-role" *ngIf="isAdmin()">Administrator</div>
        </div>
      </div>

      <!-- Navigation Links -->
      <div class="mobile-nav">
        <!-- Admin Navigation -->
        <div class="mobile-nav-section" *ngIf="isAdmin()">
          <a routerLink="/admin" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7" />
              <rect x="14" y="3" width="7" height="7" />
              <rect x="14" y="14" width="7" height="7" />
              <rect x="3" y="14" width="7" height="7" />
            </svg>
            Dashboard
          </a>
          <a routerLink="/admin/users" routerLinkActive="active" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
            User Management
          </a>
          <a routerLink="/admin/posts" routerLinkActive="active" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
            </svg>
            Content Moderation
          </a>
          <a routerLink="/admin/orders" routerLinkActive="active" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="9" cy="21" r="1" />
              <circle cx="20" cy="21" r="1" />
              <path d="m1 1 4 4 13 0 1 8-12 0z" />
            </svg>
            Order Management
          </a>
        </div>

        <!-- Regular User Navigation -->
        <div class="mobile-nav-section" *ngIf="!isAdmin()">
          <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
            </svg>
            Home
          </a>
          <a routerLink="/dashboard" routerLinkActive="active" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7" />
              <rect x="14" y="3" width="7" height="7" />
              <rect x="14" y="14" width="7" height="7" />
              <rect x="3" y="14" width="7" height="7" />
            </svg>
            Dashboard
          </a>
          <a routerLink="/community" routerLinkActive="active" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
            </svg>
            Community
          </a>
          <a routerLink="/marketplace" routerLinkActive="active" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
            </svg>
            Marketplace
          </a>
          <a routerLink="/itineraries" routerLinkActive="active" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
            </svg>
            Itineraries
          </a>
          <a routerLink="/travel-buddies" routerLinkActive="active" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
            Travel Buddies
          </a>
          <a routerLink="/local-guides" routerLinkActive="active" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="10" r="3" />
              <path d="M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 7 8 11.7z" />
            </svg>
            Local Guides
          </a>
          <a routerLink="/ai-chat" routerLinkActive="active" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12l2 2 4-4"/>
              <path d="M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
            AI Travel Assistant
          </a>
          <a routerLink="/chat" routerLinkActive="active" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
            </svg>
            Chat
          </a>
        </div>

        <!-- Unauthenticated Navigation -->
        <div class="mobile-nav-section" *ngIf="!isAuthenticated">
          <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
            </svg>
            Home
          </a>
          <a routerLink="/community" routerLinkActive="active" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
            </svg>
            Community
          </a>
          <a routerLink="/marketplace" routerLinkActive="active" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
            </svg>
            Marketplace
          </a>
          <a routerLink="/itineraries" routerLinkActive="active" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
            </svg>
            Itineraries
          </a>
          <a routerLink="/travel-buddies" routerLinkActive="active" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
            Travel Buddies
          </a>
        </div>

        <div class="mobile-divider" *ngIf="isAuthenticated"></div>

        <div class="mobile-nav-section" *ngIf="isAuthenticated">
          <a routerLink="/profile" (click)="closeMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
            Profile Settings
          </a>
          <button (click)="logout(); closeMobileMenu()" class="mobile-logout">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
              <polyline points="16 17 21 12 16 7" />
              <line x1="21" y1="12" x2="9" y2="12" />
            </svg>
            Sign Out
          </button>
        </div>

        <div class="mobile-nav-section" *ngIf="!isAuthenticated">
          <button (click)="go('/signin'); closeMobileMenu()" class="btn btn-outline">
            Sign In
          </button>
          <button (click)="go('/signup'); closeMobileMenu()" class="btn btn-primary">
            Sign Up
          </button>
        </div>
      </div>
    </div>
  </div>
</nav>