<nav
  class="navbar"
  [class.nav-hidden]="hidden"
  [class.nav-scrolled]="scrolled"
  [class.no-bg-transition]="suppressTransition"
>
  <div class="navbar-inner">
    <div class="nav-left">
      <a class="brand" (click)="go('/')" aria-label="Travner home">
        <span class="brand-logo">TR</span>
        <span class="brand-text">Travner</span>
      </a>
      <div class="primary-links">
        <a
          routerLink="/"
          routerLinkActive="active"
          [routerLinkActiveOptions]="{ exact: true }"
          (click)="closeMobileMenu()"
          >Home</a
        >
        <a
          routerLink="/dashboard"
          routerLinkActive="active"
          (click)="closeMobileMenu()"
          *ngIf="isAuthenticated"
          >Dashboard</a
        >
        <a
          routerLink="/community"
          routerLinkActive="active"
          (click)="closeMobileMenu()"
          >Community</a
        >
        <a
          routerLink="/admin"
          routerLinkActive="active"
          (click)="closeMobileMenu()"
          *ngIf="isAuthenticated && isAdmin()"
          >Admin</a
        >
      </div>
    </div>

    <div class="nav-right" *ngIf="!isAuthenticated">
      <button class="ghost" (click)="go('/signin')">Sign In</button>
      <button class="primary" (click)="go('/signup')">Sign Up</button>
      <button class="icon" (click)="toggleTheme()" aria-label="Toggle theme">
        <ng-container *ngIf="(theme$ | async) === 'light'; else darkIcon">
          <svg
            viewBox="0 0 24 24"
            width="20"
            height="20"
            stroke="currentColor"
            fill="none"
            stroke-width="2"
          >
            <circle cx="12" cy="12" r="5" />
            <line x1="12" y1="1" x2="12" y2="3" />
            <line x1="12" y1="21" x2="12" y2="23" />
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
            <line x1="1" y1="12" x2="3" y2="12" />
            <line x1="21" y1="12" x2="23" y2="12" />
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
          </svg>
        </ng-container>
        <ng-template #darkIcon>
          <svg
            viewBox="0 0 24 24"
            width="20"
            height="20"
            stroke="currentColor"
            fill="none"
            stroke-width="2"
          >
            <path d="M21 12.79A9 9 0 0 1 11.21 3 7 7 0 1 0 21 12.79z" />
          </svg>
        </ng-template>
      </button>
    </div>

    <div class="nav-right auth" *ngIf="isAuthenticated">
      <button class="icon" (click)="toggleTheme()" aria-label="Toggle theme">
        <ng-container *ngIf="(theme$ | async) === 'light'; else darkIcon2">
          <svg
            viewBox="0 0 24 24"
            width="20"
            height="20"
            stroke="currentColor"
            fill="none"
            stroke-width="2"
          >
            <circle cx="12" cy="12" r="5" />
          </svg>
        </ng-container>
        <ng-template #darkIcon2>
          <svg
            viewBox="0 0 24 24"
            width="20"
            height="20"
            stroke="currentColor"
            fill="none"
            stroke-width="2"
          >
            <path d="M21 12.79A9 9 0 0 1 11.21 3 7 7 0 1 0 21 12.79z" />
          </svg>
        </ng-template>
      </button>
      <div class="user" [class.open]="showUserMenu">
        <button
          class="user-btn"
          (click)="toggleUserMenu()"
          aria-haspopup="menu"
          [attr.aria-expanded]="showUserMenu"
        >
          <span class="avatar">{{ initials }}</span>
          <span class="name">{{
            currentUser?.firstName || currentUser?.userName
          }}</span>
          <svg
            viewBox="0 0 24 24"
            width="18"
            height="18"
            stroke="currentColor"
            fill="none"
            stroke-width="2"
          >
            <polyline points="6 9 12 15 18 9" />
          </svg>
        </button>
        <div class="menu" *ngIf="showUserMenu" (mouseleave)="closeUserMenu()">
          <button (click)="go('/dashboard'); closeUserMenu()">Dashboard</button>
          <button (click)="go('/community'); closeUserMenu()">Community</button>
          <button *ngIf="isAdmin()" (click)="go('/admin'); closeUserMenu()">
            Admin Panel
          </button>
          <hr />
          <button class="danger" (click)="logout(); closeUserMenu()">
            Logout
          </button>
        </div>
      </div>
    </div>

    <button
      class="hamburger"
      (click)="toggleMobileMenu()"
      aria-label="Toggle navigation"
    >
      <span></span><span></span><span></span>
    </button>
  </div>

  <div class="mobile-panel" *ngIf="showMobileMenu">
    <div class="mobile-links">
      <a
        routerLink="/"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }"
        (click)="closeMobileMenu()"
        >Home</a
      >
      <a
        routerLink="/dashboard"
        routerLinkActive="active"
        (click)="closeMobileMenu()"
        *ngIf="isAuthenticated"
        >Dashboard</a
      >
      <a
        routerLink="/community"
        routerLinkActive="active"
        (click)="closeMobileMenu()"
        >Community</a
      >
      <a
        routerLink="/admin"
        routerLinkActive="active"
        (click)="closeMobileMenu()"
        *ngIf="isAuthenticated && isAdmin()"
        >Admin</a
      >
    </div>
    <div class="mobile-actions" *ngIf="!isAuthenticated">
      <button class="ghost" (click)="go('/signin'); closeMobileMenu()">
        Sign In
      </button>
      <button class="primary" (click)="go('/signup'); closeMobileMenu()">
        Create Account
      </button>
    </div>
    <div class="mobile-actions" *ngIf="isAuthenticated">
      <div class="user-summary">
        <div class="avatar">{{ initials }}</div>
        <div>
          <div class="name">
            {{ currentUser?.firstName || currentUser?.userName }}
          </div>
          <div class="role" *ngIf="isAdmin()">Admin</div>
        </div>
      </div>
      <button (click)="go('/dashboard'); closeMobileMenu()">Dashboard</button>
      <button (click)="go('/community'); closeMobileMenu()">Community</button>
      <button *ngIf="isAdmin()" (click)="go('/admin'); closeMobileMenu()">
        Admin Panel
      </button>
      <button class="danger" (click)="logout(); closeMobileMenu()">
        Logout
      </button>
    </div>
    <div class="mobile-theme">
      <button (click)="toggleTheme()">Toggle Theme</button>
    </div>
  </div>
</nav>
