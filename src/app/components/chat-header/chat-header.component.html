<!-- Enhanced Chat Header -->
<div class="chat-header">
  <div class="header-left">
    <h1 class="chat-title">
      <svg
        class="chat-icon"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <path
          d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
        ></path>
      </svg>
      Chat
    </h1>
  </div>

  <div class="header-center">
    <!-- User Search Section -->
    <div class="search-section" [class.active]="showUserSearch">
      <button
        type="button"
        class="search-toggle-button"
        (click)="toggleUserSearch()"
        [attr.aria-label]="
          showUserSearch ? 'Close user search' : 'Search for users'
        "
        [class.active]="showUserSearch"
      >
        <svg
          *ngIf="!showUserSearch"
          class="search-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <svg
          *ngIf="showUserSearch"
          class="close-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
        <span class="search-button-text">{{
          showUserSearch ? "Cancel" : "New Chat"
        }}</span>
      </button>

      <!-- User Search Component -->
      <div class="search-dropdown" *ngIf="showUserSearch">
        <app-user-search
          (userSelected)="onUserSelected($event)"
          (onCancel)="onSearchCancel()"
          placeholder="Search users to start a conversation..."
          [showCancel]="false"
        ></app-user-search>
      </div>
    </div>
  </div>

  <div class="header-right">
    <!-- Current User Info -->
    <div class="current-user" *ngIf="currentUser">
      <span class="username">{{ currentUser.userName }}</span>
      <div class="user-avatar">
        <img
          *ngIf="currentUser.profileImageUrl; else defaultAvatar"
          [src]="currentUser.profileImageUrl"
          [alt]="currentUser.displayName || currentUser.userName"
          class="avatar-image"
        />
        <ng-template #defaultAvatar>
          <div class="default-avatar">
            {{ getInitials(currentUser.displayName || currentUser.userName) }}
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Menu Button -->
    <button type="button" class="menu-button" aria-label="Menu">
      <svg
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
  </div>
</div>
