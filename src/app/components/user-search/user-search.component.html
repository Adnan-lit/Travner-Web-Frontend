<!-- User Search Component Template -->
<div class="user-search-container">
  <!-- Search Input -->
  <div class="search-input-wrapper">
    <input
      type="text"
      [formControl]="searchControl"
      [placeholder]="placeholder"
      (focus)="onFocus()"
      (blur)="onBlur()"
      (keydown)="onKeyDown($event)"
      class="search-input"
      autocomplete="off"
    />
    <div class="search-input-icons">
      <!-- Loading spinner -->
      <div *ngIf="loading" class="loading-spinner">
        <div class="spinner"></div>
      </div>
      <!-- Search icon -->
      <svg
        *ngIf="!loading"
        class="search-icon"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
    </div>
    <!-- Cancel button -->
    <button
      *ngIf="showCancel"
      type="button"
      class="cancel-button"
      (click)="onCancelClick()"
    >
      Cancel
    </button>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-message">
    <svg
      class="error-icon"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
    >
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="15" y1="9" x2="9" y2="15"></line>
      <line x1="9" y1="9" x2="15" y2="15"></line>
    </svg>
    {{ errorMessage }}
  </div>

  <!-- Search Results -->
  <div class="search-results" *ngIf="showResults">
    <div class="results-container">
      <!-- No results -->
      <div *ngIf="searchResults.length === 0 && !loading" class="no-results">
        <svg
          class="no-results-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="8.5" cy="7" r="4"></circle>
          <line x1="20" y1="8" x2="20" y2="14"></line>
          <line x1="23" y1="11" x2="17" y2="11"></line>
        </svg>
        <p>No users found</p>
        <small>Try a different search term</small>
      </div>

      <!-- User Results -->
      <div class="user-results" *ngIf="searchResults.length > 0">
        <div
          *ngFor="let user of searchResults; trackBy: trackByUserId"
          class="user-result-item"
          (click)="onUserSelect(user)"
          tabindex="0"
          role="button"
          [attr.aria-label]="'Start chat with ' + getDisplayName(user)"
        >
          <!-- User Avatar -->
          <div class="user-avatar">
            <img
              [src]="getAvatarUrl(user)"
              [alt]="getDisplayName(user)"
              class="avatar-image"
              (error)="handleImageError($event, user.userName)"
            />
          </div>

          <!-- User Info -->
          <div class="user-info">
            <h4 class="user-name">{{ getDisplayName(user) }}</h4>
            <p class="username">{{ "@" + user.userName }}</p>
            <p *ngIf="user.bio" class="user-bio">{{ user.bio }}</p>
            <div *ngIf="user.location" class="user-location">
              <svg
                class="location-icon"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
              <span>{{ user.location }}</span>
            </div>
          </div>

          <!-- Action Icon -->
          <div class="action-icon">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M12 5l7 7-7 7"></path>
            </svg>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="loading" class="loading-state">
        <div class="loading-spinner">
          <div class="spinner"></div>
        </div>
        <p>Searching users...</p>
      </div>
    </div>
  </div>
</div>
