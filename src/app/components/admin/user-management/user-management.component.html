<div class="user-management">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="fas fa-users"></i>
        User Management
      </h1>
      <p class="page-subtitle">Manage user accounts, roles, and permissions</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-outline" (click)="exportUsers()">
        <i class="fas fa-download"></i>
        Export
      </button>
      <button class="btn btn-primary" routerLink="/admin/users/create">
        <i class="fas fa-plus"></i>
        Add User
      </button>
    </div>
  </div>

  <!-- User Statistics -->
  <div class="stats-section">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
          <h3>{{userStats.totalUsers | number}}</h3>
          <p>Total Users</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-user-check"></i>
        </div>
        <div class="stat-content">
          <h3>{{userStats.activeUsers | number}}</h3>
          <p>Active Users</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-user-shield"></i>
        </div>
        <div class="stat-content">
          <h3>{{userStats.adminUsers | number}}</h3>
          <p>Admin Users</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-user-times"></i>
        </div>
        <div class="stat-content">
          <h3>{{userStats.bannedUsers | number}}</h3>
          <p>Banned Users</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-user-plus"></i>
        </div>
        <div class="stat-content">
          <h3>{{userStats.newUsersToday | number}}</h3>
          <p>New Today</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-calendar-week"></i>
        </div>
        <div class="stat-content">
          <h3>{{userStats.newUsersThisWeek | number}}</h3>
          <p>New This Week</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="filters-section">
    <div class="filters-grid">
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input 
          type="text" 
          placeholder="Search users by name, email, or username..."
          [(ngModel)]="filters.search"
          (input)="onSearchChange($any($event.target).value)"
          class="search-input">
      </div>
      
      <select [(ngModel)]="filters.role" (change)="onFilterChange()" class="filter-select">
        <option value="">All Roles</option>
        <option value="USER">User</option>
        <option value="ADMIN">Admin</option>
        <option value="MODERATOR">Moderator</option>
      </select>
      
      <select [(ngModel)]="filters.status" (change)="onFilterChange()" class="filter-select">
        <option value="">All Status</option>
        <option value="ACTIVE">Active</option>
        <option value="INACTIVE">Inactive</option>
        <option value="BANNED">Banned</option>
        <option value="PENDING">Pending</option>
      </select>
      
      <select [(ngModel)]="filters.sortBy" (change)="onSortChange()" class="filter-select">
        <option value="createdAt">Sort by Date</option>
        <option value="firstName">Sort by Name</option>
        <option value="email">Sort by Email</option>
        <option value="lastLogin">Sort by Last Login</option>
      </select>
      
      <select [(ngModel)]="filters.sortOrder" (change)="onSortChange()" class="filter-select">
        <option value="desc">Newest First</option>
        <option value="asc">Oldest First</option>
      </select>
    </div>
  </div>

  <!-- Bulk Actions -->
  <div class="bulk-actions" *ngIf="showBulkActions">
    <div class="bulk-actions-content">
      <span class="selected-count">{{selectedUsers.size}} users selected</span>
      <div class="bulk-buttons">
        <button class="btn btn-sm btn-danger" (click)="bulkAction('delete')">
          <i class="fas fa-trash"></i>
          Delete
        </button>
        <button class="btn btn-sm btn-warning" (click)="bulkAction('ban')">
          <i class="fas fa-ban"></i>
          Ban
        </button>
        <button class="btn btn-sm btn-success" (click)="bulkAction('activate')">
          <i class="fas fa-check"></i>
          Activate
        </button>
        <button class="btn btn-sm btn-outline" (click)="selectedUsers.clear(); showBulkActions = false">
          <i class="fas fa-times"></i>
          Cancel
        </button>
      </div>
    </div>
  </div>

  <!-- Users Table -->
  <div class="table-container">
    <table class="users-table">
      <thead>
        <tr>
          <th class="checkbox-column">
            <input 
              type="checkbox" 
              [checked]="selectedUsers.size === users.length && users.length > 0"
              [indeterminate]="selectedUsers.size > 0 && selectedUsers.size < users.length"
              (change)="selectAllUsers()">
          </th>
          <th>User</th>
          <th>Role</th>
          <th>Status</th>
          <th>Last Login</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of users" class="user-row">
          <td class="checkbox-column">
            <input 
              type="checkbox" 
              [checked]="selectedUsers.has(user.id)"
              (change)="toggleUserSelection(user.id)">
          </td>
          <td class="user-info">
            <div class="user-avatar">
              <img 
                *ngIf="user.profileImageUrl; else defaultAvatar"
                [src]="user.profileImageUrl" 
                [alt]="user.firstName + ' ' + user.lastName">
              <ng-template #defaultAvatar>
                <div class="avatar-placeholder">
                  {{getInitials(user.firstName || '', user.lastName || '')}}
                </div>
              </ng-template>
            </div>
            <div class="user-details">
              <h4 class="user-name">{{user.firstName}} {{user.lastName}}</h4>
              <p class="user-username">{{'@' + user.userName}}</p>
              <p class="user-email">{{user.email}}</p>
            </div>
          </td>
          <td>
            <span class="badge" [ngClass]="getRoleBadgeClass(user.role || 'USER')">
              {{user.role || 'USER'}}
            </span>
          </td>
          <td>
            <span class="badge" [ngClass]="getStatusBadgeClass(user.status || 'ACTIVE')">
              {{user.status || 'ACTIVE'}}
            </span>
          </td>
          <td class="date-cell">
            {{user.lastLogin || user.lastLoginAt ? formatDate(user.lastLogin || user.lastLoginAt!) : 'Never'}}
          </td>
          <td class="date-cell">
            {{formatDate(user.createdAt || '')}}
          </td>
          <td class="actions-cell">
            <div class="action-buttons">
              <button class="btn btn-sm btn-outline" (click)="viewUser(user)" title="View Details">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn btn-sm btn-primary" (click)="editUser(user)" title="Edit User">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-danger" (click)="deleteUser(user)" title="Delete User">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoading">
      <div class="loading-content">
        <div class="spinner"></div>
        <p>Loading users...</p>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!isLoading && users.length === 0">
      <div class="empty-content">
        <i class="fas fa-users"></i>
        <h3>No users found</h3>
        <p>Try adjusting your search criteria or filters</p>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination-section" *ngIf="pagination.totalPages > 1">
    <div class="pagination-info">
      Showing {{getPaginationInfo()}} users
    </div>
    
    <div class="pagination-controls">
      <select [(ngModel)]="pagination.size" (change)="onPageSizeChange($any($event.target).value)" class="page-size-select">
        <option value="10">10 per page</option>
        <option value="20">20 per page</option>
        <option value="50">50 per page</option>
        <option value="100">100 per page</option>
      </select>
      
      <div class="pagination-buttons">
        <button 
          class="btn btn-outline btn-sm" 
          [disabled]="pagination.page === 0"
          (click)="onPageChange(pagination.page - 1)">
          <i class="fas fa-chevron-left"></i>
        </button>
        
        <button 
          *ngFor="let page of getPageNumbers()"
          class="btn btn-sm"
          [ngClass]="page === pagination.page ? 'btn-primary' : 'btn-outline'"
          (click)="onPageChange(page)">
          {{page + 1}}
        </button>
        
        <button 
          class="btn btn-outline btn-sm" 
          [disabled]="pagination.page === pagination.totalPages - 1"
          (click)="onPageChange(pagination.page + 1)">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- User Details Modal -->
<div class="modal-overlay" *ngIf="showUserModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()" *ngIf="selectedUser">
    <div class="modal-header">
      <h2>User Details</h2>
      <button class="modal-close" (click)="closeModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <div class="user-profile">
        <div class="profile-avatar">
          <img 
            *ngIf="selectedUser.profileImageUrl; else defaultAvatar"
            [src]="selectedUser.profileImageUrl" 
            [alt]="selectedUser.firstName + ' ' + selectedUser.lastName">
          <ng-template #defaultAvatar>
            <div class="avatar-placeholder-large">
              {{getInitials(selectedUser.firstName || '', selectedUser.lastName || '')}}
            </div>
          </ng-template>
        </div>
        <div class="profile-details">
          <h3>{{selectedUser.firstName}} {{selectedUser.lastName}}</h3>
          <p class="username">{{'@' + selectedUser.userName}}</p>
          <p class="email">{{selectedUser.email}}</p>
          <div class="profile-badges">
            <span class="badge" [ngClass]="getRoleBadgeClass(selectedUser.role || 'USER')">
              {{selectedUser.role || 'USER'}}
            </span>
            <span class="badge" [ngClass]="getStatusBadgeClass(selectedUser.status || 'ACTIVE')">
              {{selectedUser.status || 'ACTIVE'}}
            </span>
          </div>
        </div>
      </div>
      
      <div class="profile-info">
        <div class="info-row">
          <label>Created:</label>
          <span>{{formatDate(selectedUser.createdAt || '')}}</span>
        </div>
        <div class="info-row">
          <label>Last Login:</label>
          <span>{{selectedUser.lastLogin || selectedUser.lastLoginAt ? formatDate(selectedUser.lastLogin || selectedUser.lastLoginAt!) : 'Never'}}</span>
        </div>
        <div class="info-row" *ngIf="selectedUser.bio">
          <label>Bio:</label>
          <span>{{selectedUser.bio}}</span>
        </div>
        <div class="info-row" *ngIf="selectedUser.location">
          <label>Location:</label>
          <span>{{selectedUser.location}}</span>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" (click)="closeModal()">Close</button>
      <button class="btn btn-primary" (click)="editUser(selectedUser)">Edit User</button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()" *ngIf="selectedUser">
    <div class="modal-header">
      <h2>Delete User</h2>
      <button class="modal-close" (click)="closeModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to delete <strong>{{selectedUser.firstName}} {{selectedUser.lastName}}</strong>?</p>
      <p class="text-danger">This action cannot be undone and will permanently remove the user and all their data.</p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" (click)="closeModal()">Cancel</button>
      <button class="btn btn-danger" (click)="confirmDeleteUser()">Delete User</button>
    </div>
  </div>
</div>
