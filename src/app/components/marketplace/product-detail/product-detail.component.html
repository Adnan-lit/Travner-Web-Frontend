<div class="product-detail-container" *ngIf="!loading && !error">
  <!-- Cart Summary Widget -->
  <app-cart-summary></app-cart-summary>

  <div class="product-detail-content" *ngIf="product">
    <!-- Product Images -->
    <div class="product-images">
      <div class="main-image">
        <img
          [src]="product.images[selectedImageIndex] || getPlaceholderImage(product.name)"
          alt="{{ product.name }}"
          (error)="handleImageError($event)"
        />
      </div>

      <div
        class="thumbnail-images"
        *ngIf="product.images && product.images.length > 1"
      >
        <div
          class="thumbnail"
          *ngFor="let image of product.images; let i = index"
          [class.active]="i === selectedImageIndex"
          (click)="selectImage(i)"
        >
          <img
            [src]="image"
            alt="{{ product.name }} thumbnail"
            (error)="handleImageError($event)"
          />
        </div>
      </div>
    </div>

    <!-- Product Info -->
    <div class="product-info">
      <h1 class="product-title">{{ product.name }}</h1>

      <div class="product-price">
        {{ formatPrice(product.price) }}
      </div>

      <div class="product-stock" [class]="getStockClass(product.stockQuantity)">
        {{ getStockStatus(product.stockQuantity) }}
      </div>

      <div class="product-description">
        <h3>Description</h3>
        <p>{{ product.description }}</p>
      </div>

      <div class="product-category">
        <span class="category-label">Category:</span>
        <span class="category-value">{{ product.category }}</span>
      </div>

      <!-- Quantity Selector -->
      <div class="quantity-selector" *ngIf="product.stockQuantity > 0">
        <label for="quantity">Quantity:</label>
        <div class="quantity-controls">
          <button
            class="quantity-btn"
            (click)="decreaseQuantity()"
            [disabled]="quantity <= 1"
          >
            -
          </button>
          <input
            type="number"
            id="quantity"
            [(ngModel)]="quantity"
            min="1"
            [max]="product.stockQuantity"
            class="quantity-input"
          />
          <button
            class="quantity-btn"
            (click)="increaseQuantity()"
            [disabled]="quantity >= product.stockQuantity || quantity >= 10"
          >
            +
          </button>
        </div>
        <span class="max-quantity" *ngIf="product.stockQuantity < 10">
          Max: {{ product.stockQuantity }}
        </span>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button
          class="btn btn-primary add-to-cart-btn"
          (click)="addToCart()"
          [disabled]="product.stockQuantity === 0"
          *ngIf="product.stockQuantity > 0"
        >
          Add to Cart
        </button>

        <button
          class="btn btn-secondary buy-now-btn"
          (click)="buyNow()"
          [disabled]="product.stockQuantity === 0"
          *ngIf="product.stockQuantity > 0"
        >
          Buy Now
        </button>

        <button class="btn btn-disabled" disabled *ngIf="product.stockQuantity === 0">
          Out of Stock
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading product details...</p>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="error && !loading">
    <p class="error-message">{{ error }}</p>
    <button class="btn btn-secondary" (click)="ngOnInit()">Try Again</button>
  </div>
</div>
