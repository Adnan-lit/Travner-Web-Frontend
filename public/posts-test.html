<!DOCTYPE html>
<html>
  <head>
    <title>Posts API Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ccc;
      }
      .success {
        background-color: #d4edda;
        border-color: #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        border-color: #f5c6cb;
      }
      button {
        padding: 10px 15px;
        margin: 5px;
      }
      pre {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
        white-space: pre-wrap;
        max-height: 400px;
        overflow: auto;
      }
    </style>
  </head>
  <body>
    <h1>Posts API Response Test</h1>

    <div class="test-section">
      <h3>Test Results:</h3>
      <div id="results"></div>
    </div>

    <button onclick="testPostsEndpoint()">Test GET Posts</button>
    <button onclick="testCreatePost()">Test CREATE Post</button>

    <script>
      async function testPostsEndpoint() {
        const resultsDiv = document.getElementById("results");
        resultsDiv.innerHTML = "<p>Testing posts endpoint...</p>";

        try {
          const response = await fetch("/posts?page=0&size=10", {
            method: "GET",
            headers: {
              Authorization: "Basic " + btoa("testuser:testpass"),
              Accept: "application/json",
              "Content-Type": "application/json",
            },
          });

          const responseText = await response.text();
          let responseData;

          try {
            responseData = JSON.parse(responseText);
          } catch (e) {
            responseData = responseText;
          }

          const className = response.ok ? "success" : "error";
          resultsDiv.innerHTML = `
                    <div class="test-section ${className}">
                        <h4>Response Status: ${response.status} ${
            response.statusText
          }</h4>
                        <h4>Response Headers:</h4>
                        <pre>${Array.from(response.headers.entries())
                          .map(([key, value]) => `${key}: ${value}`)
                          .join("\n")}</pre>
                        <h4>Response Body:</h4>
                        <pre>${JSON.stringify(responseData, null, 2)}</pre>
                    </div>
                `;
        } catch (error) {
          resultsDiv.innerHTML = `
                    <div class="test-section error">
                        <h4>Error occurred:</h4>
                        <pre>${error.message}</pre>
                    </div>
                `;
        }
      }

      async function testCreatePost() {
        const resultsDiv = document.getElementById("results");
        resultsDiv.innerHTML = "<p>Testing create post endpoint...</p>";

        const postData = {
          title: "Amazing Trip to Paris",
          content:
            "I had an incredible experience visiting Paris. The Eiffel Tower was breathtaking!",
          location: "Paris, France",
          tags: ["travel", "paris", "europe"],
          mediaIds: [],
          published: true,
        };

        try {
          const response = await fetch("/posts", {
            method: "POST",
            headers: {
              Authorization: "Basic " + btoa("testuser:testpass"),
              Accept: "application/json",
              "Content-Type": "application/json",
            },
            body: JSON.stringify(postData),
          });

          const responseText = await response.text();
          let responseData;

          try {
            responseData = JSON.parse(responseText);
          } catch (e) {
            responseData = responseText;
          }

          const className = response.ok ? "success" : "error";
          resultsDiv.innerHTML = `
                    <div class="test-section ${className}">
                        <h4>CREATE Post Response Status: ${response.status} ${
            response.statusText
          }</h4>
                        <h4>Request Body:</h4>
                        <pre>${JSON.stringify(postData, null, 2)}</pre>
                        <h4>Response Headers:</h4>
                        <pre>${Array.from(response.headers.entries())
                          .map(([key, value]) => `${key}: ${value}`)
                          .join("\n")}</pre>
                        <h4>Response Body:</h4>
                        <pre>${JSON.stringify(responseData, null, 2)}</pre>
                    </div>
                `;
        } catch (error) {
          resultsDiv.innerHTML = `
                    <div class="test-section error">
                        <h4>Error occurred:</h4>
                        <pre>${error.message}</pre>
                    </div>
                `;
        }
      }

      // Auto-run test on page load
      window.onload = () => testPostsEndpoint();
    </script>
  </body>
</html>
