<!DOCTYPE html>
<html>
  <head>
    <title>Proxy Test - All Endpoints</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ccc;
      }
      .success {
        background-color: #d4edda;
        border-color: #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        border-color: #f5c6cb;
      }
      button {
        padding: 10px 15px;
        margin: 5px;
      }
      pre {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <h1>Travner API Proxy Test - All Endpoints</h1>

    <div class="test-section">
      <h3>Test Results:</h3>
      <div id="results"></div>
    </div>

    <button onclick="testAllEndpoints()">Test All Proxy Endpoints</button>

    <script>
      async function testEndpoint(path, name) {
        try {
          const response = await fetch(path, {
            method: "GET",
            headers: {
              Authorization: "Basic " + btoa("testuser:testpass"),
            },
          });

          return {
            name: name,
            path: path,
            status: response.status,
            success: response.status !== 404,
            message:
              response.status === 404
                ? "Not proxied (404)"
                : response.status === 401
                ? "Proxied successfully (401 = auth required)"
                : response.status === 403
                ? "Proxied successfully (403 = forbidden)"
                : `Proxied (${response.status})`,
          };
        } catch (error) {
          return {
            name: name,
            path: path,
            status: "ERROR",
            success: false,
            message: error.message,
          };
        }
      }

      async function testAllEndpoints() {
        const resultsDiv = document.getElementById("results");
        resultsDiv.innerHTML = "<p>Testing proxy endpoints...</p>";

        const endpoints = [
          { path: "/user", name: "User Auth" },
          { path: "/posts", name: "Posts" },
          { path: "/api/chat/conversations", name: "Chat API" },
          { path: "/market/products", name: "Marketplace" },
          { path: "/admin/users", name: "Admin" },
          { path: "/public/check-username/test", name: "Public API" },
        ];

        const results = [];
        for (const endpoint of endpoints) {
          const result = await testEndpoint(endpoint.path, endpoint.name);
          results.push(result);
        }

        let html = "<h4>Proxy Test Results:</h4>";
        results.forEach((result) => {
          const className = result.success ? "success" : "error";
          html += `
                    <div class="test-section ${className}">
                        <strong>${result.name}</strong> (${result.path})<br>
                        Status: ${result.status}<br>
                        Result: ${result.message}
                    </div>
                `;
        });

        resultsDiv.innerHTML = html;
      }

      // Auto-run test on page load
      window.onload = () => testAllEndpoints();
    </script>
  </body>
</html>
